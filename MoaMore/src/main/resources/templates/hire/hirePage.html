<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	  layout:decorate="~{template/layout}">

<head>
<style>
	#id{
		display:inline;
	}
	#hireButtons{
		float:right;
	}
	.image{
		position:relative;
	}
	.btn1{
		position: absolute;
  		right : 15px; 
	}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
<meta charset="UTF-8">
<title>HirePage</title>
</head>
<body>
	<div layout:fragment = "content">
		<div class = "container">
		
			<label for = "name">직군</label> 
			<select id = "job" class = "selectStyle">
				<option selected value = ''>개발 전체</option>
				<option th:each="list : ${list.N}" th:text="${list.desct}" th:attr="value=${list.prov}">직무</option>
			</select>
			
			<label for="name">지역</label> 
			<select id="loc" class = "selectStyle">
				<option selected value=''>전국</option>
				<option th:each="list : ${list.X}" th:text="${list.desct}" th:attr="value=${list.prov}">지역</option>
			</select>
			
			<label for = "name">경력</label> 
			<select id="cre" class = "selectStyle">
				<option selected value = ''>경력전체</option>
				<option th:each="list : ${list.Y}" th:text="${list.desct}" th:attr="value=${list.prov}">경력</option>
			</select>
			
			<label for = "name">기술선택</label> 
			<select id = "skl" class = "selectStyle">
				<option selected value=''>기술 전체</option>
				<option th:each="list : ${list.Z}" th:text="${list.desct}" th:attr="value=${list.prov}">기술</option>
			</select>
			
			<button type="submit" class="btn btn-outline-dark btn-sm searchBtn" id="search">
				<i class="fas fa-search fa-2x"></i>
			</button>
								
			<div id="hireButtons">
			<!-- 현재로그인된 유저가 가진 권한 -->
	        	<div sec:authorize="hasRole('ROLE_MEM')">
					<button type="button" class="btn btn-outline-dark" id="scrapList">스크랩 정렬</button>
				</div>
				<div sec:authorize="hasRole('ROLE_CO')" >
					<button type="button" class="btn btn-outline-dark" id="hireInsert">등록하기</button>
				</div> 
			</div>
		</div>
		
		<section class="pt-0" id="hireAllList">
			<div class="container">
				<div  class="row mt-7 gx-xl-7"  id = "hireList" >
				<!--  AJAX 조회가 들어가는부분  -->
				</div>
			</div>
		</section>
		
		<script>
		$(document).ready(function () {
			search();
		});
		
		// 공고등록으로 이동
		$(document).on('click', '#hireInsert', function(e){
			e.preventDefault();

			location.href="/hireInsert";
			
			
		});
		
		$('#scrapList').click(function() {
			
			let data = {
					"job" : $("#job").val(), // 직군
					"wksite" : $("#loc").val(), // 지역
					"carr" : $("#cre").val(), // 경력
					"skill" : $("#skl").val(), // 기술스펙
					"scrapYn" : "Y" // 스크랩 여부
	    	    } 
			
			search(data);
		});
			
		$('#search').click(function(){
			
			let data = {
					"job" : $("#job").val(), // 직군
					"wksite" : $("#loc").val(), // 지역
					"carr" : $("#cre").val(), // 경력
					"skill" : $("#skl").val() // 기술스펙
	    	    } 	
			
			search(data);
		});
		
		function search(data){
		
		     $.ajax({
	            url: "/data",
	            type: "GET",
	            data: data,
	            dataType: "json",
	            success: function(data) {
	                $("#hireList").empty();
	                
	                $.each(data, function(index, item) {
	                	var str1 = ``;
	                	var str2 = ``;
	                	var str3 = ``;
	                	
	                	if(item.scrapYn != null){
	                		str1 = `<div class="col-md-3 text-center text-md-start h-auto mb-5" >
					    							<div class="d-flex justify-content-between flex-column h-100">
					    						
					                				<div class="image">
														<img class="w-75 w-md-100 rounded-2 " src="/moamoreImg/`+item.coImg+`" alt="" />
														<i class="bi bi-bookmark-heart-fill fs-5 btn1 text-danger" ></i>
													</div>`;
		                	} else{
		                		str1 = `<div class="col-md-3 text-center text-md-start h-auto mb-5" >
					    							<div class="d-flex justify-content-between flex-column h-100">
					                				
					    							<div class="image">
														<img class="w-75 w-md-100 rounded-2 " src="/moamoreImg/`+item.coImg+`" alt="" />
														<i class="bi bi-bookmark-heart-fill fs-5 btn1" ></i>
													</div>`;
		                	}
		                	
	                	
		                	str2 = `<div class="d-flex align-items-center justify-content-center justify-content-md-start gap-2 mt-3">
		                				<a href="/hireInfo?recruitNo=`+item.recruitNo+`&skill=`+item.skill+`" style="text-decoration: none;">						
		                							<p class="fw-bold mb-0 text-black" >`+item.skill+`</p>
													<p class="mb-0"  >`+item.exprDt+`</p>
												</div>
												
												<h5 class="mt-1 mb-3 fs-0 fs-md-1" >`+item.ttl+`</h5>
												<p class="mb-0" >`+item.wksite+`</p>
												
												<div class="d-flex align-items-center justify-content-center justify-content-md-start gap-3">
													<img class="img-fluid" src="assets/img/blog/profile1.png" alt="" />
														`;
				    		if(item.followYn != null){	
				    			str3 = `<span class="mb-0 text-danger" >`+item.coNm+`</span>
												</div>
											</div>
										</a>
						    		</div>`;
				    		}else {
				    			str3 = `<span class="mb-0 text-gray" >`+item.coNm+`</span>
											</div>
										</div>
									</a>
					    		</div>`;
				    		}
		    					$("#hireList").append(str1+str2+str3);
	                });
	                
	            },

	            error: function(xhr, status, error) {
	            }
	        }); }
		
		</script>
	</div>
</body>
</html>