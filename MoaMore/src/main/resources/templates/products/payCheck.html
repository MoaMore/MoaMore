<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{template/layout}">
<head>

<style>
#top {
	background: #fff;
}

section {
	background: #fff;
}

#body {
	background: #fff;
}
</style>
<!-- Google Fonts -->
<link href="https://fonts.gstatic.com" rel="preconnect">
<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
	rel="stylesheet">

<!-- Vendor CSS Files -->
<link href="adminAssets/vendor/bootstrap/css/bootstrap.min.css"
	rel="stylesheet">
<link href="adminAssets/vendor/bootstrap-icons/bootstrap-icons.css"
	rel="stylesheet">
<link href="adminAssets/vendor/boxicons/css/boxicons.min.css"
	rel="stylesheet">
<link href="adminAssets/vendor/quill/quill.snow.css" rel="stylesheet">
<link href="adminAssets/vendor/quill/quill.bubble.css" rel="stylesheet">
<link href="adminAssets/vendor/remixicon/remixicon.css" rel="stylesheet">
<link href="adminAssets/vendor/simple-datatables/style.css"
	rel="stylesheet">
<!-- 결제 -->
<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
<!-- datePicker -->
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/gh/dubrox/Multiple-Dates-Picker-for-jQuery-UI@master/jquery-ui.multidatespicker.js"></script>
<link rel="stylesheet" type="text/css"
	href="http://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">

<!-- Template Main CSS File -->
<link href="adminAssets/css/style.css" rel="stylesheet">
<meta charset="UTF-8">
<title>Insert title here</title>

</head>
<body id="body">
	<div class="container d-flex justify-content-center"
		layout:fragment="content">
		<div class="card col-lg-5 ">
			<div class="card-body ">
				<h3 class="card-title fw-bold">프리미엄-광고 결제</h3>
				<br>
				<!-- Horizontal Form -->
				<form>
					<div class="row mb-3">
						<p class="col-sm-3 text-end fs-5 fw-normal">상품명</p>
						<div class="col-sm-8 text-end">
							<p class="fs-5 fw-normal"
								th:text="'광고 '+${product.prdtNm}"></p>
						</div>
					</div>
					<div class="row mb-3">
						<p class="col-sm-3 text-end fs-5 fw-normal">상품가격</p>
						<div class="col-sm-8 text-end">
							<p th:if="${#strings.equals(param.count, '1')}"
								class="fs-5 fw-normal">110,000 원</p>
							<p th:if="${#strings.equals(param.count, '3')}"
								class="fs-5 fw-normal">330,000 원</p>
							<p th:if="${#strings.equals(param.count, '5')}"
								class="fs-5 fw-normal">550,000 원</p>
						</div>
					</div>
					<div class="row mb-3">
						<p class="col-sm-3 text-end fs-5 fw-normal">할인가</p>
						<div class="col-sm-8 text-end">
							<div th:if="${#strings.equals(param.count, '1')}">
								<p class="fs-5 fw-normal">-11,000 원</p>
								<small class="fw-bold text-danger">10% 할인</small>
							</div>
							<div th:if="${#strings.equals(param.count, '3')}">
								<p class="fs-5 fw-normal">-66,000 원</p>
								<small class="fw-bold text-danger">20% 할인</small>
							</div>
							<div th:if="${#strings.equals(param.count, '5')}">
								<p class="fs-5 fw-normal">-165,000 원</p>
								<small class="fw-bold text-danger">30% 할인</small>
							</div>
						</div>
					</div>
					<hr>
					<div class="row mb-3">
						<p class="col-sm-3 text-end fs-5 fw-normal">결제금액</p>
						<div class="col-sm-8 text-end">
							<div th:if="${#strings.equals(param.count, '1')}">
								<p class="fs-3 fw-bold text-success">99,000 원</p>
							</div>
							<div th:if="${#strings.equals(param.count, '3')}">
								<p class="fs-3 fw-bold text-success">264,000 원</p>
							</div>
							<div th:if="${#strings.equals(param.count, '5')}">
								<p class="fs-3 fw-bold text-success">385,000 원</p>
							</div>
						</div>
					</div>
					<hr>
					<div class="row mb-3">
						<p class="col-sm-3 text-end fs-5 fw-normal">적용공고</p>
						<div class="col-sm-8 text-end">
							<select id="gonggo" class="form-select">
								<option selected="">선택</option>
								<option th:each=" item : ${RecList}" th:text="${item.ttl}" th:value="${item.recruitNo}"></option>
							</select>
						</div>
					</div>
					<div class="row mb-3">
						<p class="col-sm-3 text-end fs-5 fw-normal">날짜선택</p>
						<div class="col-sm-8 text-end">
							<input readonly style="background-color: white;"
								class="form-control" id="datePick" /></input>
						</div>
					</div>
					<hr>

					<div class="row mb-3 d-flex justify-content-center">
						<div class="col-sm-10"
							style="height: 200px; padding: 20px; background-color: #f7f7f7;">
							<div style="overflow-y: scroll; height: 160px;">
								<p>[이용안내]</p>
								<p>- 멤버십 상품은 구매일로부터 이용 기간 내에 이용 가능한 상품입니다.</p>
								<p>- 멤버십 상품은 결제가 완료되는 즉시 이용 가능합니다.</p>
								<p>- 이용 기간 중 PC, 모바일웹, 스마트폰(앱)에서 이용가능합니다. (단, 일부서비스는 PC에서만
									가능)</p>
								<p>- 일부 콘텐츠는 기업 및 작성자의 요청에 따라 열람이 거부될 수 있습니다.</p>
								<p>- 콘텐츠 특성상 실사용 도중 해지 및 이에 따른 환불이 불가능합니다.</p>
								<p>단, 결제일로부터 7일 이내에 콘텐츠(텍스트, 영상 등 일체)를 시청하지 않은 경우에만 전액 환불이
									가능합니다.(환불 수수료 없음)</p>
								<p>- 아이디 공유가 적발 될 경우, 이용 자격이 박탈되며 환불이 불가능합니다.</p>
								<p>- 기타 불법 공유 행위가 적발될 경우, 형사 고발 조치가 진행될 수 있습니다.</p>
								<p>- 결제에 따른 개인 정보는 '개인정보처리방침'에 근거하여 관리됩니다.</p>
							</div>
						</div>
					</div>

					<div class="row mb-12">
						<div class="col-sm-12 offset-sm-12 d-flex justify-content-center">
							<div class="form-check">
								<input class="form-check-input" type="checkbox" id="gridCheck1">
								<p class="form-check-p" for="gridCheck1">위의 결제정보를 확인하였고 이에
									동의합니다.</p>
							</div>
						</div>
					</div>
					<div class="text-center">
						<button type="button" onclick="requestPay()">결제</button>
						<button type="reset" class="btn btn-secondary">Reset</button>
					</div>
				</form>
				<!-- End Horizontal Form -->
				<button onclick="test()">test</button>
			</div>
		</div>
		<script th:inline="javascript">
		//5꽉 날짜 막기
			var disabledDates = [];	
			
			document.addEventListener("DOMContentLoaded", function() {
				let dates = [[${disabledDates}]] 
				for(let i=0;i<dates.length;i++){
					disabledDates.push(dates[i].reserDt);
				}
		      });
			
			$(function() {
				$('#datePick').multiDatesPicker({
					dateFormat: 'yy-mm-dd',
					maxPicks : [[${param.count}]],
					 beforeShowDay: function(date) {
				            if (disabledDates.includes($.datepicker.formatDate('yy-mm-dd', date))) {
				                return [false];
				            } else {
				                return [true];
				            }
				        }
				});
			});
			//주문번호 만들기용 현재 날짜 230508144425
			function makeUid(){
				const now = new Date();
				const year = now.getFullYear().toString().slice(-2);
				const month = (now.getMonth() + 1).toString().padStart(2, '0');
				const day = now.getDate().toString().padStart(2, '0');
				const hours = now.getHours().toString().padStart(2, '0');
				const minutes = now.getMinutes().toString().padStart(2, '0');
				const seconds = now.getSeconds().toString().padStart(2, '0');

				const result = `${year}${month}${day}${hours}${minutes}${seconds}`;
				return [[${id}]]+"-"+result
			}
			//결제확인체크
			function agreeCheck(){
				if(document.querySelector('input[type="checkbox"]').checked == false){
					alert("결제정보에 동의 해주세요")
					return false;
				}
			}
			//결제 창
			var IMP = window.IMP; // 생략 가능
			IMP.init("imp70354300"); // 예: imp00000000  
			
			
			var name="광고 노출"+ [[${param.count}]]+"회 이용권"
			var amount;
			var uid=makeUid();
			var recruitNo = document.querySelector('#gonggo').value;
			var prdtCd = [[${param.prdtCd}]][0];
			var id = [[${id}]];
			//var reserDts = 
			
			function requestPay() {
				if(agreeCheck() == false){
					return;
				};
				IMP.request_pay({
					pg : "TC0ONETIME",
					pay_method : "card",
					merchant_uid : uid, // 주문번호
					name : name,
					amount : amount, // 숫자 타입
					buyer_name : "홍길동",
					buyer_postcode : "01181"
				}, function(rsp) { // callback
					
					console.log(rsp);
				});
			}
			//결제 성공 시
			function afterPay(){
				
					$.ajax({
						url : "afterPay",
						method : "POST",
						data : {
							orderNo : uid,
							recruitNo : recruitNo,
							prdtCd : prdtCd,
							id : id,
							reserDts : reserDts
						},
						dataType : "json",//받는타입
						contentType : "application/json",//보내는타입
						success : function(res) {
							console.log(res);
						},
						error : function(jqXHR, textStatus, errorThrown) {
							console.error(textStatus, errorThrown);
						},
					}); 	
				
				 
			}
		</script>
	</div>



</body>
</html>