<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{template/layout}">
<head>
<meta charset="UTF-8">
<title>모아모아/셀프구직</title>
<!-- selfJobList.CSS -->
<link href="self/selfJobList.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
</head>
<body>
	<div layout:fragment="content">
	
		<!-- 현재로그인된 유저정보 -->
		<input id="logId" name="id" type="hidden" th:value="${#authentication.principal.username}">
		
		<!-- 현재로그인된 유저가 가진 권한 -->
		<div sec:authorize="hasRole('ROLE_USER')">
			<input id="ROLE_USER" value="ROLE_USER"> 
		</div>
		<div sec:authorize="hasRole('ROLE_CO')">
			<input id="ROLE_CO" value="ROLE_CO"> 
		</div>
		
		<!-- nav -->
		<div class="row">
			<div class="col-md-1"></div>
			<div class="col-md-10" style="border-bottom : 1px solid #ddd;">
				<div style="background-color: white;">
					<div style="display:flex; justify-content: center;">
						<select class="selectStyle">
						    <option>활동분야</option>
						    <option>두번째 선택항목</option>
						    <option>세번째 선택항목</option>
						</select>
						<select class="selectStyle">
						    <option>경력조건</option>
						    <option>두번째 선택항목</option>
						    <option>세번째 선택항목</option>
						</select>
						<select class="selectStyle">
						    <option>지역</option>
						    <option>두번째 선택항목</option>
						    <option>세번째 선택항목</option>
						</select>
						<div style="display:flex;">
							<input type="text" class="search" placeholder="이름을 입력하세요">
							<button type="button" class="btn btn-dark btn-sm searchBtn radius">
								<i class="fas fa-search fa-lg"></i>
							</button>
						</div>
						<div class="ms-5">
							<button id="myProfile" type="button" class="btn btn-outline-danger btn-sm radius fs-1">
								My프로필 등록
							</button>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-1"></div>
		</div>
		
		<div class="row" style="margin-top : 30px;">
			<div class="col-md-1"></div>
			<div class="col-md-2" style="margin : 10px;">
				<div style="padding:18px; text-align : center;">
					<h4>Menu</h4>
					<hr>
					<ul class="listStyle">
						<li class="fs-1"><a href="#">받은제안</a></li>
						<li class="fs-1"><a href="#">수락한제안</a></li>
					</ul>
				</div>	
			</div>
			<div id="selfList" class="col-md-7">
				<!-- <div class="row align-items-center border-bottom p-4 mb-3 hoverRow">
	              <div class="col-md-3 text-center">
	              	<a href="#">
	              		<img class="img-fluid" src="assets/img/blog/blog-hero.png" alt="">
	              	</a>
	              </div>
	              <div class="col-md-6 text-center text-lg-start">
	                <div class="d-flex align-items-center justify-content-center justify-content-lg-start gap-3">
	                  <p class="fw-bold mb-0 text-black">Category</p>
	                  <p class="mb-0">November 22, 2021</p>
	                  <span><i id="heartIcon" class="bi bi-suit-heart text-danger fa-2x"></i></span>
	                </div>
	                	<p class="fs-2 my-3">한줄자기소개</p>
	                <div class="d-flex align-items-center justify-content-center justify-content-lg-start gap-2">
	                	<img class="img-fluid" src="assets/img/blog/profile1.png" alt="">
	                    <p class="mb-0">아이디</p>
	                </div>
	              </div>
	              <div class="col-md-3" style="display: flex; align-items: center; flex-direction : column;" >
				      <button type="button" class="btn btn-outline-info btn-sm listBtn">제안</button>
				  </div>
	            </div>	 -->	
	            

	             <div class="row align-items-center border-bottom p-4 mb-3 hoverRow">
	              <div class="col-md-3 text-center">
	              	<a href="#">
	              		<img class="img-fluid" src="assets/img/blog/blog-hero.png" alt="">
	              	</a>
	              </div>
	              <div class="col-md-6 text-center text-lg-start">
	                <div class="d-flex align-items-center justify-content-center justify-content-lg-start gap-3">
	                  <p class="fw-bold mb-0 text-black">Category</p>
	                  <p class="mb-0">November 22, 2021</p>
	                </div>
	                	<p class="fs-2 my-3">한줄자기소개</p>
	                <div class="d-flex align-items-center justify-content-center justify-content-lg-start gap-2">
	                	<img class="img-fluid" src="assets/img/blog/profile1.png" alt="">
	                    <p class="mb-0">아이디</p>
	                </div>
	              </div>
	              <div class="col-md-3" style="display: flex; align-items: center; flex-direction : column;" >
				      <button type="button" class="btn btn-outline-danger btn-sm listBtn">관심</button>
				      <button type="button" class="btn btn-outline-info btn-sm listBtn">제안</button>
				  </div>
	            </div>
	            
			</div>
			<div class="col-md-1"></div>
		</div>
		
<script>

/* $('#heartIcon').on('click',function() {
	if($("#heartIcon").hasClass("bi-suit-heart")){
		$(this).removeClass("bi-suit-heart");
    	$(this).addClass("bi-suit-heart-fill");
	}else{
		$(this).removeClass("bi-suit-heart-fill");
    	$(this).addClass("bi-suit-heart");
	}
}); */

$(document).ready(function() {
	
	let auth = '';
	if($('#ROLE_USER').val()){
		console.log('유저입니다');
		auth = 'user';
		
	}else if($('#ROLE_CO').val()){
		console.log('기업입니다.');
		auth = 'co';
		
	}else{
		console.log('관리자입니다.');
		auth = 'admin';
	}
	
	selfJobList(auth); // 셀프 구직 목록 리스트

});
	
function selfJobList(auth){
	
	$.ajax({
	  url: 'selfJobList',
	  type: 'post',
	  data: {auth : auth},
	  success: function (result) {
		console.log(result);
		
		selfList.innerHTML = ''; // 초기화
		
		let selfJobListHtml = '';
		for(let i = 0; i < result.length; i++){
			selfJobListHtml += selfJobListPrint(result[i]);
		}
		selfList.innerHTML = selfJobListHtml;
	  },
	  error: function (reject) {	   
   	  	console.log(reject);
	  }
	});	
}

function selfJobListPrint(result={}){
	let html = `<div class="row align-items-center border-bottom p-4 mb-3 hoverRow">
			        <div class="col-md-3 text-center">
			      	<a href="#">
			      		<img class="img-fluid" src="/moamoreImg/`+result.myimg+`" alt="이미지업로드안함">
			      	</a>
			      </div>
			      <div class="col-md-6 text-center text-lg-start">
			        <div class="d-flex align-items-center justify-content-center justify-content-lg-start gap-3">
			          <p class="fw-bold mb-0 text-black">`+result.dutyFld+`</p>
			          <p class="mb-0">`+result.hopeWksite+`</p>
			          <p class="mb-0">`+result.regDt+`</p>
			        </div>
			        	<p class="fs-2 my-3">`+result.ttl+`</p>
			        <div class="d-flex align-items-center justify-content-center justify-content-lg-start gap-2">
			        	<img class="img-fluid" src="assets/img/blog/profile1.png" alt="">
			            <p class="mb-0">`+result.id+`</p>
			        </div>
			      </div>
			      <div class="col-md-3" style="display: flex; align-items: center; flex-direction : column;" >
				      <button type="button" class="btn btn-outline-danger btn-sm listBtn">관심</button>
				      <button type="button" class="btn btn-outline-info btn-sm listBtn">제안</button>
				  </div>
			    </div>`;
			    
	return html;
			    
}


// my프로필 등록 버튼 클릭시 이력가 있는지 체크하는 함수
$('#myProfile').on('click', function(){
	
	let id = logId.value;
	//console.log(id);
	
	$.ajax({
	  url: 'selfJobCheck',
	  type: 'post',
	  data: {id : id},
	  success: function (result) {
		if(result == 0){
			alert('작성된 이력서가 없습니다. 먼저 작성해주세요');
		}else{
			location.href="/selfJobProfile";
		}
	  },
	  error: function (reject) {	   
   	  	console.log(reject);
	  }
	});	
});
		


		
</script>
	</div>
</body>
</html>